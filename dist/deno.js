"use strict";import{serve}from"https://deno.land/std/http/server.ts";let pW="0.0",pV="Deno";(()=>{var Version=class extends Array{constructor(verStr){super();let upThis=this;verStr.split(".").forEach(function(e,i){upThis[i]=parseInt(e)})}toString(){let ver="";return this.forEach(function(e,i){ver+=i!=0?".":"",ver+=e}),ver}},ProgramDetails=class{constructor(name,version){this.name=name,this.version=new Version(version)}},parseUserAgent=function(uaStr){let uaStrA=`${uaStr} `,rawArr=[],mode=0,softName="",softVer="",platDet=[""];return Array.from(uaStrA).forEach(function(e){switch(mode){case 0:{e!="/"?softName+=e:(softName=softName.trim(),mode=1);break}case 1:{e!=" "?softVer+=e:(rawArr.push(new ProgramDetails(softName,softVer)),softName="",softVer="",mode=2);break}case 2:{e=="("?mode=3:(softName+=e,mode=0);break}case 3:{e==")"?(platDet.forEach(function(e2,i,a){a[i]=e2.trim()}),rawArr[rawArr.length-1].platRaw=platDet,platDet=[""],mode=0):e==";"?platDet.push(""):platDet[platDet.length-1]+=e;break}}}),rawArr};var wrapHtml=function(status=200,title="Lorem",content="Blank."){return new Response(`<!DOCTYPE html><head><meta content="true" name="HandheldFriendly"/><title>${title}</title><style>body{font-family:sans-serif;position:absolute;width:100%;height:100%;background:#fff;margin:0;display:flex;align-items:center;justify-content:center;color:#555}#a{width:max-content;max-width:min(450px,80vw)}#b{text-align:center!important;font-weight:bold;font-size:1.5em;color:#333}#c{color:#333}#a>div{hyphens:auto;text-align:justify;padding:4px}a{text-decoration:none}#d{color:#777;font-size:0.75em}pre{overflow:scroll;padding:2px}@media(prefers-color-scheme:dark){html{filter:invert(100%)}}</style></head><body lang="en"><div id="a"><div id="b">${title}</div><div>${content}</div><div id="d"><center>Cloud Hop v${pW}@${pV}</center></div></div></body>`,{status,headers:{Server:"Cloud Hop","Content-Type":"text/html"}})};var passState=["N/A","Passed","Blocked","Suspicious"],promptText=["Ah, you seem aren't using a Chromium-based browser. No tests are performed.","All checks passed. Congrats!","Somepony is hiding themselves, how naughty.","Somepony is acting very suspicious."],handleRequest=function(request){let passed=0,uaStr=parseUserAgent(request.headers.get("user-agent")),response=wrapHtml(200,passState[passed],`${JSON.stringify(uaStr)}<br/>${promptText[passed]}`);return console.info(`Server-side detection: ${passState[passed].toLowerCase()}`),response};serve(function(request,connInfo){let clientIp=connInfo.remoteAddr.hostname;return handleRequest(request,clientIp)});})();
//# sourceMappingURL=deno.js.map
